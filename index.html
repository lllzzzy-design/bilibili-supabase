<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bç«™è§†é¢‘æ”¶è—ï¼ˆSupabaseç‰ˆï¼‰</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<h1>ğŸ¬ æˆ‘çš„Bilibiliæ”¶è—ï¼ˆäº‘ç«¯ç‰ˆï¼‰</h1>

<input id="categoryInput" placeholder="åˆ†ç±»åç§°">
<input id="videoInput" placeholder="ç²˜è´´Bç«™è§†é¢‘é“¾æ¥" style="width:300px;">
<button onclick="addVideo()">æ·»åŠ è§†é¢‘</button>

<hr>

<div id="videos"></div>

<script>
  const supabaseUrl = "https://yubkvcvwvdvcvhvviziu.supabase.co";
  const supabaseKey = "sb_publishable_bF9ourabT4dwUDTsoJi0Ng_H6CXo0ik";
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  async function loadVideos() {
    const { data, error } = await supabaseClient
      .from("videos")
      .select("*")
      .order("id", { ascending: false });

    if (error) {
      console.error(error);
      return;
    }

    render(data);
  }

  function render(videos) {
    const container = document.getElementById("videos");
    container.innerHTML = "";

    videos.forEach(video => {
      container.innerHTML += `
        <div>
          <p>åˆ†ç±»: ${video.category}</p>
          <iframe 
            src="https://player.bilibili.com/player.html?bvid=${video.bvid}"
            width="500"
            height="300"
            frameborder="0"
            allowfullscreen>
          </iframe>
          <hr/>
        </div>
      `;
    });
  }

  async function addVideo() {
    const url = document.getElementById("videoInput").value;
    const category = document.getElementById("categoryInput").value || "é»˜è®¤";
    const match = url.match(/BV\w+/);

    if (!match) {
      alert("æ— æ³•è¯†åˆ«BVå·");
      return;
    }

    const { error } = await supabaseClient
      .from("videos")
      .insert([{ bvid: match[0], category }]);

    if (error) {
      console.error(error);
      alert("æ’å…¥å¤±è´¥");
      return;
    }

    document.getElementById("videoInput").value = "";
    loadVideos();
  }

  loadVideos();
</script>

</body>
</html>